<!DOCTYPE html>
<html>
<head>
    <title>V2 API Test</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #ddd; }
        .success { background: #d4edda; }
        .error { background: #f8d7da; }
        .pending { background: #fff3cd; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Frontend V2 API Test</h1>
    <p>This page tests that the frontend is correctly using V2 API endpoints.</p>
    
    <div id="tests"></div>
    
    <script>
        const tests = [
            {
                name: 'Test 1: Project List',
                url: '/api/v2/scope/projects',
                method: 'GET'
            },
            {
                name: 'Test 2: Health Check',
                url: '/api/v2/health',
                method: 'GET'
            },
            {
                name: 'Test 3: Analyze Endpoint',
                url: '/api/v2/analyze',
                method: 'POST',
                body: { description: '10000 sf office building' }
            }
        ];
        
        async function runTests() {
            const container = document.getElementById('tests');
            
            for (const test of tests) {
                const div = document.createElement('div');
                div.className = 'test pending';
                div.innerHTML = `<h3>${test.name}</h3><p>URL: ${test.url}</p><p>Status: Testing...</p>`;
                container.appendChild(div);
                
                try {
                    const options = {
                        method: test.method,
                        headers: { 'Content-Type': 'application/json' }
                    };
                    
                    if (test.body) {
                        options.body = JSON.stringify(test.body);
                    }
                    
                    const response = await fetch(test.url, options);
                    const data = await response.json();
                    
                    div.className = 'test success';
                    div.innerHTML = `
                        <h3>✅ ${test.name}</h3>
                        <p><strong>URL:</strong> ${test.url}</p>
                        <p><strong>Status:</strong> ${response.status} ${response.statusText}</p>
                        <p><strong>Response Preview:</strong></p>
                        <pre>${JSON.stringify(data, null, 2).substring(0, 500)}...</pre>
                    `;
                    
                    // Check if this is actually V2 response
                    if (JSON.stringify(data).includes('v2') || 
                        JSON.stringify(data).includes('unified') ||
                        data.success !== undefined) {
                        div.innerHTML += '<p><strong>✅ Confirmed V2 API Response</strong></p>';
                    }
                    
                } catch (error) {
                    div.className = 'test error';
                    div.innerHTML = `
                        <h3>❌ ${test.name}</h3>
                        <p><strong>URL:</strong> ${test.url}</p>
                        <p><strong>Error:</strong> ${error.message}</p>
                    `;
                }
            }
            
            // Summary
            const summary = document.createElement('div');
            summary.className = 'test';
            summary.innerHTML = `
                <h2>Summary</h2>
                <p>All tests completed. Check the Network tab in DevTools to verify:</p>
                <ul>
                    <li>All API calls go to <code>/api/v2/*</code> (not <code>/api/v1/*</code>)</li>
                    <li>Responses are being proxied through port 3000 to backend port 8001</li>
                    <li>No CORS errors (proxy handles this)</li>
                </ul>
            `;
            container.appendChild(summary);
        }
        
        // Run tests on load
        runTests();
    </script>
</body>
</html>