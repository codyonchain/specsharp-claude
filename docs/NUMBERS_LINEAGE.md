# Numbers Lineage (Frontend Anchor)
This document maps every metric surfaced in the V2 UI to the payloads and helpers that feed it. For each number we identify the React component, whether the value comes straight from the backend JSON (`analysis.calculations` / `calculation_data`), from `BackendDataMapper`, or from UI-level formulas, and we capture the payload paths used today. Backend compute ownership is deliberately left as `TBD` until we finish the backend half of the audit. Use the table below to trace any UI metric back to the data contract and to flag places where frontend fallbacks might diverge from backend intent.

| UI Label / Card | Frontend Source (file + component) | Input Source Type | Payload Path / Formula Input | Backend Compute Location | Notes |
| --- | --- | --- | --- | --- | --- |
| Total Investment Required (hero) | `frontend/src/v2/pages/ProjectView/ExecutiveViewComplete.tsx` (lines 1948-1954) | Backend payload | `project.analysis.calculations.totals.total_project_cost` | TBD (UnifiedEngine totals) | Cost path; basis for most downstream % calcs. |
| Cost per SF (hero subtitle) | same as above | Backend payload | `project.analysis.calculations.totals.cost_per_sf` | TBD | Cost path; derived when project saved. |
| Construction total (hero “CONSTRUCTION”) | `ExecutiveViewComplete.tsx` (1986-1994) | Backend payload | `analysis.calculations.construction_costs.construction_total` | TBD | Hard-cost subtotal, pre soft costs. |
| Annual Revenue (hero metrics) | `ExecutiveViewComplete.tsx` (lines 424-436) via `displayData.annualRevenue` | BackendDataMapper derived | `BackendDataMapper.mapToDisplay → annualRevenue` (mapper tries `roi_analysis.financial_metrics.annual_revenue` → `ownership_analysis.annual_revenue` → return metrics → fallback `estimated_annual_noi / 0.6`, `frontend/src/v2/utils/backendDataMapper.ts:1085-1106`) | TBD | Market path; fallback ratio flagged in section 6. |
| Operating Margin | `ExecutiveViewComplete.tsx` (435-533) | BackendDataMapper derived | `displayData.operatingMargin` or `displayData.operationalEfficiency.operating_margin` | TBD | Market path; UI cascades through multiple aliases. |
| Estimated NOI (hero “NOI”) | `ExecutiveViewComplete.tsx` (1187-1267) using `displayData.noi` | BackendDataMapper derived | Mapper picks best of `return_metrics.estimated_annual_noi`, `ownership_analysis.noi` (see lines ~705-712) | TBD | Market path; used for NOI gap + DSCR scaling. |
| ROI / Investment Decision chip | `ExecutiveViewComplete.tsx` (2058-2205) via `displayData.roi`, `displayData.decisionReason` | BackendDataMapper derived | `BackendDataMapper.extractROI` (`frontend/src/v2/utils/backendDataMapper.ts:1061-1065`) plus heuristics for reason text (lines 1159-1170) | TBD | Market path; ROI is whichever field backend populates first. |
| DSCR card | `ExecutiveViewComplete.tsx` (1253-1776) using `displayData.dscr` | BackendDataMapper derived | `displayData.dscr` from mapper (prefers `ownership_analysis.debt_metrics.calculated_dscr`) | TBD | Financing metric; compared against `targetDscr`. |
| Soft Costs % of Total (Operational KPIs) | `ExecutiveViewComplete.tsx` (610-669) | UI derived | `softCostsValue = totals.soft_costs`, `totalCostValue = totals.total_project_cost`, `pct = softCosts/total` | Backend totals computed earlier | Cost path; UI division only. |
| Facility Metrics – Units / Cost per Unit / Revenue per Unit | `ExecutiveViewComplete.tsx` (2412-2632) & `displayData.facilityMetrics` | BackendDataMapper derived | `displayData.facilityMetrics` assembled from `analysis.calculations.facility_metrics` (restaurants/healthcare) or mapper heuristics (lines 676-830) | TBD | Type-specific; mix of backend + mapper calculations. |
| Revenue Efficiency Metrics (`displayData.revenueMetrics`) | `ExecutiveViewComplete.tsx` (549-605) | BackendDataMapper derived | `displayData.revenueMetrics` built from backend `operational_metrics/revenue_metrics` | TBD | Market path; dynamic per building type. |
| Construction View hero (Construction Cost + $/SF) | `frontend/src/v2/pages/ProjectView/ConstructionView.tsx` (1134-1176) | Backend payload | `analysis.calculations.construction_costs.construction_total`, `displayCostPerSF` (derived from `totals.cost_per_sf`) | TBD | Cost path. |
| Trade Breakdown (doughnut + table) | `ConstructionView.tsx` (sections around 601-780 & 1350-1580) | Backend payload | `analysis.calculations.trade_breakdown` (and scope items) | TBD | Used for charts/scope detail; relies on stored percentages. |
| Soft Cost Breakdown | `ConstructionView.tsx` (approx. lines 860-1020) | Backend payload | `analysis.calculations.soft_costs` | TBD | Cost path; UI formats each bucket. |
| Timeline / Schedule | `ConstructionView.tsx` (approx. lines 1180-1450) | Backend payload | `analysis.calculations.project_timeline` and `construction_schedule` | TBD | Derived server-side; UI only formats dates. |
| Scenario Export | `ConstructionView.tsx` + `ExecutiveViewComplete.tsx` PDF buttons | Backend payload for stored runs | `pdfService.exportProject → /pdf/project/{id}/pdf` (see docs/AUDIT_RUNTIME_PATH) | TBD | Uses same calculation_data. |
| Payback Period fallback | `BackendDataMapper.extractPaybackPeriod` (`frontend/src/v2/utils/backendDataMapper.ts:1068-1083`) | BackendDataMapper derived | `if return_metrics.payback_period missing => total_cost / estimated_annual_noi (capped)` | TBD | Marked risk: derived solely on frontend. |
| Annual Revenue fallback | `BackendDataMapper.extractAnnualRevenue` (`frontend/src/v2/utils/backendDataMapper.ts:1085-1106`) | BackendDataMapper derived | `estimated_annual_noi / 0.6` when all other fields absent | TBD | Hard-coded margin assumption; market risk. |
| Unit Count fallback | `BackendDataMapper.extractUnitCount` (`frontend/src/v2/utils/backendDataMapper.ts:1108-1136`) | BackendDataMapper derived | Various SF ÷ avg unit sizes per building type (multifamily, healthcare, educational, office) | TBD | Type-specific heuristics; rebuild when backend adds explicit units. |
| Decision Reason narrative | `ExecutiveViewComplete.tsx` (investment panel) via `BackendDataMapper.generateDecisionReason` (`frontend/src/v2/utils/backendDataMapper.ts:1159-1170`) | UI derived (mapper) | Branching logic based on ROI/NPV/DSCR thresholds | TBD | Messaging shifts if thresholds change. |
| Soft cost cards (Construction tab) | `ConstructionView.tsx` (cards listing design/permits/etc.) | Backend payload | `analysis.calculations.soft_costs.<bucket>` | TBD | Cost path; percentages defined server-side. |
| Cost Build-Up chip | `ExecutiveViewComplete.tsx` (cost build-up pill list) | Backend payload via mapper | `displayData.constructionCostBuildUp` ← `calculation_data.construction_costs.cost_build_up` | TBD | Shows elements like Base/Regional/Finish multipliers. |
| Revenue Requirement Gap (NOI gap panel) | `ExecutiveViewComplete.tsx` (1253-1776) | BackendDataMapper derived | `displayData.requiredNoiPerSf`, `displayData.currentNoiPerSf`, `displayData.requiredNoi` (mapper uses `revenue_requirements`) | TBD | Market/financing mix; ensures UI stays consistent with backend requirements block. |

# Known Frontend Fallbacks / Synthetic Metrics
- **Payback Period** – `frontend/src/v2/utils/backendDataMapper.ts:1068-1083`: `period = totals.total_project_cost / return_metrics.estimated_annual_noi` when backend payback missing; capped at 999 years.
- **Annual Revenue** – `frontend/src/v2/utils/backendDataMapper.ts:1085-1106`: Falls back to `estimated_annual_noi / 0.6` if neither `roi_analysis`, `ownership_analysis`, nor return metrics expose an annual revenue field.
- **Unit Count** – `frontend/src/v2/utils/backendDataMapper.ts:1108-1136`: When `project_info.unit_count` absent, estimates units by `square_footage / avgUnitSize` (multifamily), `/1333` (healthcare beds), `/900` (classrooms), `/15000` (office floors), default `1` otherwise.
- **Decision Reason Text** – `frontend/src/v2/utils/backendDataMapper.ts:1159-1170`: Frontend-generated narrative (e.g., ROI below threshold) based on ROI/NPV/DSCR thresholds; backend does not author this string today.
